<html><head><link rel="import" href="../vendors/polymer/polymer-element.html"><link rel="import" href="vegan-styles-common.html"><link rel="import" href="libraries/elasticlunr.html"></head><body><dom-module id="vegan-search"><template><link type="text/css" rel="stylesheet" href="https://use.fontawesome.com/ac44d0f306.css"><style include="vegan-styles-common"></style><style>form{position:relative;}.search-input{outline:0;box-sizing:border-box;width:100%;border:2px solid #68EA77;border-radius:5px;padding:12px 12px 12px 50px;font-size:16px;color:#333;-moz-appearance:none;-webkit-appearance:none;appearance:none;}.search-input::-webkit-search-cancel-button{display:none;}.search-icon{position:absolute;left:12px;color:#757575;font-size:1.5em;height:100%;display:flex;justify-content:center;align-items:center;}</style><form on-submit="handleFormSubmit"><div class="search-icon"><i class="fa fa-search" aria-hidden="true"></i></div><input name="search-term" class="search-input" type="search" role="search" autocomplete="off" placeholder="[[placeholder]]" aria-label="[[placeholder]]" value="{{searchQuery}}" on-keyup="handleKeyInput"></form></template><script>var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var SEARCH_CONFIGURATION={fields:{title:{boost:2},collection:{boost:2},contents:{boost:1}},expand:!0},VeganSearch=function(a){function b(){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return c.placeholder="Find the goodness...",c.setupSearch(),c}return _inherits(b,a),_createClass(b,null,[{key:"is",get:function(){return"vegan-search"}},{key:"properties",get:function(){return{placeholder:String,searchQuery:{type:String,notify:!0},searchResults:{type:Object,notify:!0}}}}]),_createClass(b,[{key:"setupSearch",value:function(){var d=this,f=sessionStorage.getItem("articles");f?(this.articles=JSON.parse(f).result,this.buildIndex()):fetch("/data/articles.json").then(function(g){return g.json()}).then(function(g){d.articles=g.result.map(function(h){return h.collection=h.collection.filter(function(j){return"articles"!==j}),h}),sessionStorage.setItem("articles",JSON.stringify(g)),console.info("Search: successfully loaded all the articles into session storage."),d.buildIndex()}).catch(function(g){console.err("Search: Error during setup: "+g)})}},{key:"buildIndex",value:function(){var d=this;this.searchIndex=elasticlunr(function(){this.addField("title"),this.addField("contents"),this.addField("collection"),this.setRef("id")}),this.articles.forEach(function(f,g){return d.searchIndex.addDoc(Object.assign({id:g},f))}),console.info("Search: index is ready for searches.")}},{key:"handleKeyInput",value:function(d){var f=d.target.value;f!==this.searchQuery&&(this.searchQuery=f,3<=this.searchQuery.length?this.doSearch():this.clearSearch())}},{key:"doSearch",value:function(){var d=this,f=this.searchIndex.search(this.searchQuery.toLowerCase(),SEARCH_CONFIGURATION);console.info("Search: found "+f.length+" articles."),this.set("searchResults.message",(0<f.length?f.length:"No")+" articles found."),this.set("searchResults.articles",f.map(function(g){var h=d.searchIndex.documentStore.getDoc(g.ref);return h.path=h.path.replace("/index.md","/").replace(".md","/"),h}))}},{key:"clearSearch",value:function(){this.set("searchResults.message",""),this.set("searchResults.articles",[])}},{key:"handleFormSubmit",value:function(d){return d.preventDefault(),!1}}]),b}(Polymer.Element);customElements.define(VeganSearch.is,VeganSearch);</script></dom-module></body></html>